!function(t){function e(){var t=require("topten_pc:widget/ui/ceiling/ceiling.js"),e=new t("j-sort-bar",{ceilingClass:"spec-nav-fixed"});e.init()}function i(){t("#j-w-filter-area").delegate("a.filter-checkbox","click",function(){var e=t(this);e.hasClass("checked")?e.removeClass("checked"):e.addClass("checked"),s()})}function s(){var e=F.context("link");t("#j-w-filter-area").find(".checked").each(function(){e+="&"+t(this).attr("id")+"=1"}),t("#j-w-filter-area").find("a").each(function(){t(this).attr("href",e)})}function n(){t("#j-close").on("click",function(){t("#fix-bottom").css("display","none")}),setTimeout(function(){t("#fix-bottom").css("display","none")},3e3)}function a(){var e=t(".wifi-icon");e.hover(function(){var e=t(this).parent().prev(".title").width()-33;t(this).parent().next(".tipContent").show().css("left",e);var i=t(window).height()-t(this).height()-(t(this).offset().top-t(document).scrollTop());26>i&&t(this).parent().next(".tipContent").show().css("top","-9px")},function(){t(this).parent().next(".tipContent").hide().css("top","37px")})}function r(){t(".j-icons").size()>0&&t(".j-icons").each(function(){t(this).find("span").size()>1&&t(this).prev(".title").addClass("max-width")})}var h=function(){this.init.apply(this,arguments)};t.extend(h.prototype,{init:function(e){var i=t(".j-item").last();return this.parent=i.parents("ul"),this.getJingxuanUrl="/mis/t10/ajaxt10deallist?p=",this.pageIndex=2,this.currentPage=0,this.pageTotal=0,this.isLastPage=!1,this.Template=require("topten_pc:widget/ui/template/template.js").template,this.isGetData=!0,t.extend(this,e),this.pageTotal=1*this.pageTotal,this.itemSize=1*i.index()+1,this.itemSize>=this.pageTotal?this:(this.run(),this.bindEvent(),a(),void r())},getLastElm:function(){return t(".j-item").last()},show:function(){var e=this.vertical(),i=this,s=window.location.href,n="";s.indexOf("timelimit")>=0&&(n+="&timelimit=1"),s.indexOf("appointment")>=0&&(n+="&appointment=1"),s.indexOf("card")>=0&&(n+="&card=1"),s.indexOf("voucher")>=0&&(n+="&voucher=1"),e&&!this.isLastPage&&this.currentPage!=this.pageIndex&&(t.get(this.getJingxuanUrl+this.pageIndex+n,function(t){if(0==t.errno){t=t.data;var e=!0,s=0;if(t.t10Deals.total>0){var n=t.t10Deals.list;if(n&&"undefined"!=typeof n.length){s=n.length;for(var a=0;s>a;a++)n[a].ugc_width="undefined"!=typeof n[a].ugc_score?14*n[a].ugc_score:0,"undefined"==typeof n[a].reservation&&(n[a].reservation=0),"undefined"==typeof n[a].wifi&&(n[a].wifi=!1),"undefined"==typeof n[a].ugc_num&&(n[a].ugc_num=0)}else for(var r in n)n[r]&&n[r].deal_url&&(s+=1);e?(i.parent.append(i.Template("tplJingxuan",{list:n,s:t.s_deals,pos:1*i.parent.children().size()+1,st:'{"s":"'+t.s_deals+'","cid":"'+(t.t10Deals.cid?t.t10Deals.cid:"")+'"}'})),i.itemSize+=s,i.itemSize>=i.pageTotal&&(i.isLastPage=!0),i.currentPage=i.pageIndex,++i.pageIndex):i.isLastPage=!0,i.isGetData=!0}}else i.isGetData=!0},"json"),this.isGetData=!1)},run:function(){if(this.isGetData&&this.itemSize<this.pageTotal){var t=this;t.show()}},vertical:function(){return this.getLastElm().offset().top<t(document).scrollTop()+t(window).height()+200},bindEvent:function(){var e=this;t(window).bind("resize",function(){e.run()}),t(window).bind("scroll",function(){e.run(),a(),r()})}});var o=function(){this.init.apply(this,arguments)};t.extend(o.prototype,{init:function(e){if(this.container=t("#j-periodBox"),this.pointObj=t("#j-circle"),this.periods=this.container.find(".j-period"),this.periodList=[],this.index=0,this.enableClass="enable",this.disableClass="disable",this.status={1:{title:"即将开抢",clazz:"timerstart"},2:{title:"限时抢购",clazz:"timerstart xianshi"},3:{title:"本场售罄",clazz:"timerstart soldout"},4:{title:"本场结束",clazz:"timerstart soldout"}},this.state="0",t.extend(this,e),this.periodList.length<=0)return void this.container.hide();this.newTimerList=[],this.showPeriod=[],this.disablePeriod=[],this.isInit=!0,this.isStart=!1,this.currentIndex=0,this.statusChangeIndex=0;var i=new Date,s=this.periodList[0]&&this.periodList[0].starttime?this.periodList[0].starttime:"10:00:00";s=s.substr(0,s.indexOf(":")),this.tomorrowTime=new Date(i.getFullYear(),i.getMonth(),i.getDate()+1,s).getTime(),this.endTime=new Date("2033/1/1 00:00:00").getTime();var n=this.periods.eq(0);this.initPoint=parseInt(n.css("left")),this.periodsWidth=parseInt(n.css("width")),this.setTimerPeriod()},setCenterWidth:function(){this.centerWidth=Math.floor(this.container.width()-2*this.initPoint-2*this.periodsWidth)},getTimes:function(t,e){var i=e-t,s=Math.floor(i/864e5),n=i%864e5,a=Math.floor(n/36e5),r=n%36e5,h=Math.floor(r/6e4),o=r%6e4,d=Math.floor(o/1e3);return{day:s,hour:a,minutes:h,seconds:d,format:a+h+d>0?[this.toDateTwoNumber(a),this.toDateTwoNumber(h),this.toDateTwoNumber(d)].join(":"):"",min:a>0?60*a+h:h}},periodHourToWidth:function(t,e,i){var s=this.getTimes(t,e),n=i?i:this.periodsWidth,a=0;return a=n/s.min},getHour:function(t,e){return t+=e/60},getDateTwoNumber:function(t){return t=(t.indexOf(":")>=0?t:t+":00:00").split(":"),t.splice(0,2).join(":")},getCurrentDate:function(){var t=new Date;return t.getTime()},toDateTwoNumber:function(t){return 10>1*t?"0"+t:t},setTimerPeriod:function(){for(var t=this.getCurrentDate(),e=this.periodList,i=this.index+2,s=0,n=0,a=null,r=this.index,h=e.length;h>r;r++)a=e[r],a._index=r,i>r&&(s=a.StartTimeStamp,n=a.EndTimeStamp,a.__class=t>=s&&n>=t?this.enableClass:this.disableClass,this.newTimerList.length>=2&&this.newTimerList.shift(),this.newTimerList.push(a),this.index++);this.add(),this.initPoint=parseInt(this.periods.eq(0).css("left")),this.setCenterWidth(),this.daojishi(),this.updateText(),this.isInit=!1,this.update()},updateStatus:function(){if(this.isInit)this.statusChangeIndex>=0&&(this.statusIndex=this.statusChangeIndex);else if(this.statusIndex!=this.statusChangeIndex){var e=t(".j-item"),i=this.status,s=null,n=this;e.each(function(){t(this).find(".j-tiptext").size()>0&&(s=i[n.state],t(this).find(".j-tiptext").html(s.title).parent().get(0).className=s.clazz)}),this.statusIndex=this.statusChangeIndex}},daojishi:function(){var t=this.getCurrentDate(),e=this.newTimerList;e.length>=2&&(this.isStart=!1,this.state="1",this.currentIndex=0,t<e[0].StartTimeStamp?this.statusChangeIndex=0:t>=e[0].StartTimeStamp&&t<=e[0].EndTimeStamp?(this.isStart=!0,this.state="2",this.statusChangeIndex=1):t>e[0].EndTimeStamp&&t<e[1].StartTimeStamp?(this.currentIndex=1,this.statusChangeIndex=2):t>=e[1].StartTimeStamp&&t<=e[1].EndTimeStamp?(this.isStart=!0,this.currentIndex=1,this.statusChangeIndex=3,this.state="2"):this.periodList.length<=this.index&&(this.currentIndex=-1,this.statusChangeIndex=4,this.state="4"),this.isInit?this.statusChangeIndex>=0&&(this.statusIndex=this.statusChangeIndex):this.statusIndex!=this.statusChangeIndex&&(this.statusIndex=this.statusChangeIndex,window.location.reload()))},pos:function(){var t=this.pointObj,e=(parseInt(t.css("left")),this.periods),i=this.getCurrentDate(),s=this.newTimerList,n=0,a=0,r=70;if(s.length>=2){if(e.removeClass(this.enableClass).addClass(this.disableClass),this.isStart=!1,this.state="1",this.currentIndex=0,r=parseInt(e.eq(0).css("left")),i<s[0].StartTimeStamp)a=r,this.statusChangeIndex=0;else if(i>=s[0].StartTimeStamp&&i<=s[0].EndTimeStamp)n=this.periodHourToWidth(s[0].StartTimeStamp,s[0].EndTimeStamp),a=this.getTimes(s[0].StartTimeStamp,i),a=a.min*n+r,e.eq(0).removeClass(this.disableClass).addClass(this.enableClass),this.isStart=!0,this.state="2",this.statusChangeIndex=1;else if(i>s[0].EndTimeStamp&&i<s[1].StartTimeStamp)n=this.periodHourToWidth(s[0].EndTimeStamp,s[1].StartTimeStamp,this.centerWidth),a=this.getTimes(s[0].EndTimeStamp,i),a=a.min*n+r+this.periodsWidth,this.currentIndex=1,this.statusChangeIndex=2;else if(i>=s[1].StartTimeStamp&&i<=s[1].EndTimeStamp)n=this.periodHourToWidth(s[1].StartTimeStamp,s[1].EndTimeStamp),a=this.getTimes(s[1].StartTimeStamp,i),a=a.min*n+r+this.periodsWidth+this.centerWidth,e.eq(1).removeClass(this.disableClass).addClass(this.enableClass),this.isStart=!0,this.currentIndex=1,this.statusChangeIndex=3,this.state="2";else{if(clearInterval(this.updateInterval),!(this.periodList.length<=this.index))return void this.setTimerPeriod();a=parseInt(this.container.width())-r,this.currentIndex=-1,this.statusChangeIndex=4,this.state="4"}this.isInit?t.css("left",a).show():t.stop(!0).animate({left:a},400),this.updateStatus()}},updateText:function(){var t="",e="";clearInterval(this.updateTextInterval);var i=null,s=this,n=s.container.find(".newtime .j-text");this.updateTextInterval=setInterval(function(){s.currentIndex>=0?(t=s.isStart?"距结束":"距开始",i=s.newTimerList[s.currentIndex],e=s.getTimes(s.getCurrentDate(),i[s.isStart?"EndTimeStamp":"StartTimeStamp"]).format,e&&(n.__lastTime="00:00:00")):(e=s.getTimes(s.getCurrentDate(),s.tomorrowTime).format,t="距开始"),e=e?e:n.__lastTime,e=e.split(":"),n.html(['<span class="timetext">',t,'</span><span class="t">',e[0],"</span>",'<span class="t">',e[1],"</span>",'<span class="t">',e[2],"</span>"].join(""))},1e3)},add:function(){var e=this.periods,i=null,s=this,n=this.newTimerList;e.each(function(e){i=n[e],t(this).html(['<div class="start">',s.getDateTwoNumber(i.starttime),"</div>",'<div class="end">',s.getDateTwoNumber(i.endtime),"</div>"].join("")).removeClass(s.enableClass).removeClass(s.disableClass).addClass(i.__class).addClass("pos"+e)})},update:function(){{var t=this;this.pointObj}this.updateInterval=setInterval(function(){t.daojishi()},1e3)},end:function(){clearInterval(this.updateInterval)}}),t(function(){var t=F.context("period"),s=[];if(t&&t instanceof Object){for(var a in t)isNaN(a)||s.push(t[a]);t=null,delete t}new o({periodList:s}),new h({pageTotal:F.context("pageTotal")||0}),i(),n(),e()})}(jQuery);